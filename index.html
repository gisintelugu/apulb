<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ULB Performance Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    /* Layout safety */
    *,*::before,*::after{box-sizing:border-box}

    body{font-family:Arial,Helvetica,sans-serif;margin:16px;background:#f7f9fc}m
    .header{display:flex;align-items:center;justify-content:space-between}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-top:14px}
    .card{background:white;padding:12px;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.08)}
    .card h3{margin:0 0 6px 0;font-size:14px;color:#444}
    .card p{margin:6px 0 0;font-size:20px;font-weight:700}
    .small{font-size:12px;color:#666}
    input, select{padding:8px;border-radius:6px;border:1px solid #ccc}

    /* Overall page: left content + right column */
    .layout{display:grid;grid-template-columns:1fr 520px;gap:12px;margin-top:12px}

    /* Top row inside left column: narrower map + pie beside it */
    .topRow{
      display:grid;
      grid-template-columns:minmax(520px,1fr) 400px; /* left map flexes, pie fixed */
      gap:12px; align-items:start; grid-auto-rows:minmax(0,auto);
    }
    .topRow > .card{min-width:0;} /* prevent grid child overflow */
    #mapBox{height:500px}
    #mapPlaceholder{height:420px}

    /* Pie container sizing to avoid overlap */
    #gradePieCard{display:flex;flex-direction:column;min-width:0;}
    #gradePie{height:455px !important;} /* tweak this to change pie size */

    /* Bottom row under the map (left column) */
    #bottom{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}

    /* Right column stack */
    #rightCol{display:grid;gap:12px;align-content:start}
    #populationByDistrict{height:260px}

    /* Table styles */
    #ulbTableWrap{max-height:420px;overflow:auto;border:1px solid #eee;border-radius:6px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    thead th{position:sticky;top:0;background:#f9fbff;color:#444;border-bottom:1px solid #e5e9f2;cursor:pointer;padding:8px}
    tbody td{padding:8px;border-bottom:1px solid #f0f2f7}
    tbody tr:hover{background:#f6f8ff}
    td.num{text-align:right}
    .table-controls{display:flex;gap:8px;margin-bottom:8px}

    /* Responsive */
    @media (max-width:1300px){
      .layout{grid-template-columns:1fr}
      .topRow{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ULB Performance Dashboard</h1>
    <div class="controls">
      <label>Search ULB Code:
        <input id="searchBox" placeholder="Enter ULB CODE (e.g. 1086)" />
      </label>
      <label>Region:
        <select id="regionFilter"><option value="">All</option></select>
      </label>
      <button id="resetBtn">Reset</button>
    </div>
  </div>

  <div class="kpis">
    <div class="card"><h3>Total Households</h3><p id="kpiHouseholds">—</p><div class="small">No of HOUSE HOLD</div></div>
    <div class="card"><h3>Total Assessments</h3><p id="kpiAssessments">—</p><div class="small">As on 10-Apr-2025</div></div>
    <div class="card"><h3>Total Population</h3><p id="kpiPopulation">—</p><div class="small">As per 2011 Census</div></div>
    <div class="card"><h3>Total Area</h3><p id="kpiArea">—</p><div class="small">in Sq.Kms</div></div>
    <div class="card"><h3>Total ULBs</h3><p id="kpiUlbs">—</p><div class="small"></div></div>
  </div>

  <div class="layout">
    <div>
      <div class="topRow">
        <div id="mapBox" class="card">
  <h3>Map / Geo View</h3>
  <div id="mapPlaceholder" style="height:500px;"></div>
  <div class="note small">ULB Boundaries automatically loaded from GitHub.</div>
</div>
        <div id="gradePieCard" class="card">
          <h3>ULB Grade Distribution</h3>
          <div id="gradePie"></div>
        </div>
      </div>

      <div id="bottom">
        <div id="scatterCard" class="card">
          <h3>Area vs Population</h3>
          <div id="scatter"></div>
        </div>
        <div id="assessmentsCard" class="card">
          <h3>Assessments vs Households</h3>
          <div id="assessmentsBar"></div>
        </div>
      </div>
    </div>

    <div id="rightCol">
      <div id="populationCard" class="card">
        <h3>Population vs Assessments by District</h3>
        <div id="populationByDistrict"></div>
      </div>

      <div id="tableCard" class="card">
        <h3>ULB Assessments</h3>
        <div class="table-controls">
          <input id="tableSearch" placeholder="Search ULB..." />
        </div>
        <div id="ulbTableWrap">
          <table id="ulbTable">
            <thead>
              <tr>
                <th data-key="ulb">ULB Name</th>
                <th data-key="assessments" class="num">Assessments</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="small">Tip: Click a row to filter to that ULB. Click headers to sort. Use the search box to filter.</div>
      </div>
    </div>
  </div>

  <div class="footer small">
    <div>Data source: paste your JSON in this file. (Dashboard runs locally in your browser.)</div>
    <div class="note">Tip: Type a ULB CODE and press Enter — visuals filter to that ULB. Reset clears all filters.</div>
  </div>

<script>
/* Embedded data (full, no truncation) */
const rawData = [{"SL NO": 1, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "SRIKAKULAM", "ULB NAME": "AMUDALAVALASA", "ULB CODE": 1082, "GRADE": "II", "AREA IN SQKM": 27.85, "HOUSE HOLD": 10133, "POPULATION (2011 CEN)": 39799, "ASSESSMENTS AS ON DATE \n 10-04-25": 11966, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 2, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "VIZIANAGARAM", "ULB NAME": "BOBBILI", "ULB CODE": 1090, "GRADE": "II", "AREA IN SQKM": 25.98, "HOUSE HOLD": 14437, "POPULATION (2011 CEN)": 56819, "ASSESSMENTS AS ON DATE \n 10-04-25": 14382, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 3, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "SRIKAKULAM", "ULB NAME": "ICCHAPURAM", "ULB CODE": 1083, "GRADE": "III", "AREA IN SQKM": 21.6, "HOUSE HOLD": 10354, "POPULATION (2011 CEN)": 36493, "ASSESSMENTS AS ON DATE \n 10-04-25": 8893, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 4, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "VIZIANAGARAM", "ULB NAME": "NELLIMARLA", "ULB CODE": 1135, "GRADE": "NP", "AREA IN SQKM": 17.75, "HOUSE HOLD": 6100, "POPULATION (2011 CEN)": 26259, "ASSESSMENTS AS ON DATE \n 10-04-25": 6699, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 5, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "PARVATHIPURAM MANYAM", "ULB NAME": "PALAKONDA", "ULB CODE": 1134, "GRADE": "NP", "AREA IN SQKM": 11.09, "HOUSE HOLD": 6402, "POPULATION (2011 CEN)": 31572, "ASSESSMENTS AS ON DATE \n 10-04-25": 8075, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 6, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "PARVATHIPURAM MANYAM", "ULB NAME": "SALURU", "ULB CODE": 1092, "GRADE": "II", "AREA IN SQKM": 20.3, "HOUSE HOLD": 12425, "POPULATION (2011 CEN)": 49500, "ASSESSMENTS AS ON DATE \n 10-04-25": 12774, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 7, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "VIZIANAGARAM", "ULB NAME": "VIZIANAGARAM", "ULB CODE": 1093, "GRADE": "Corp", "AREA IN SQKM": 52.84, "HOUSE HOLD": 61925, "POPULATION (2011 CEN)": 244598, "ASSESSMENTS AS ON DATE \n 10-04-25": 73263, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 8, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "VISAKHAPATNAM", "ULB NAME": "VISAKHAPATNAM", "ULB CODE": 1086, "GRADE": "Corp", "AREA IN SQKM": 615.79, "HOUSE HOLD": 629814, "POPULATION (2011 CEN)": 1881686, "ASSESSMENTS AS ON DATE \n 10-04-25": 633879, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 9, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "VIZIANAGARAM", "ULB NAME": "RAJAM", "ULB CODE": 1133, "GRADE": "III", "AREA IN SQKM": 26.68, "HOUSE HOLD": 11158, "POPULATION (2011 CEN)": 42197, "ASSESSMENTS AS ON DATE \n 10-04-25": 12480, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 10, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "SRIKAKULAM", "ULB NAME": "SRIKAKULAM", "ULB CODE": 1085, "GRADE": "Corp", "AREA IN SQKM": 53.23, "HOUSE HOLD": 31752, "POPULATION (2011 CEN)": 166533, "ASSESSMENTS AS ON DATE \n 10-04-25": 45304, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 11, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "SRIKAKULAM", "ULB NAME": "PALASA KASIBUGGA", "ULB CODE": 1084, "GRADE": "II", "AREA IN SQKM": 31.61, "HOUSE HOLD": 14197, "POPULATION (2011 CEN)": 57507, "ASSESSMENTS AS ON DATE \n 10-04-25": 19126, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 12, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "ANAKAPALLI", "ULB NAME": "ELAMANCHILI", "ULB CODE": 1137, "GRADE": "III", "AREA IN SQKM": 46.43, "HOUSE HOLD": 12037, "POPULATION (2011 CEN)": 46159, "ASSESSMENTS AS ON DATE \n 10-04-25": 10917, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 13, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "ANAKAPALLI", "ULB NAME": "NARSIPATNAM", "ULB CODE": 1136, "GRADE": "III", "AREA IN SQKM": 34.26, "HOUSE HOLD": 16168, "POPULATION (2011 CEN)": 61540, "ASSESSMENTS AS ON DATE \n 10-04-25": 15526, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 14, "REGION": "VISAKHAPATNAM", "DISRTICT NAME": "PARVATHIPURAM MANYAM", "ULB NAME": "PARVATHIPURAM", "ULB CODE": 1091, "GRADE": "I", "AREA IN SQKM": 13.28, "HOUSE HOLD": 13010, "POPULATION (2011 CEN)": 53844, "ASSESSMENTS AS ON DATE \n 10-04-25": 14205, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 15, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KONASEEMA", "ULB NAME": "AMALAPURAM", "ULB CODE": 1059, "GRADE": "I", "AREA IN SQKM": 7.28, "HOUSE HOLD": 14123, "POPULATION (2011 CEN)": 53231, "ASSESSMENTS AS ON DATE \n 10-04-25": 17296, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 16, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "EAST GODAVARI", "ULB NAME": "KOVVUR", "ULB CODE": 1076, "GRADE": "III", "AREA IN SQKM": 17.96, "HOUSE HOLD": 10761, "POPULATION (2011 CEN)": 39667, "ASSESSMENTS AS ON DATE \n 10-04-25": 12844, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 17, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KRISHNA", "ULB NAME": "MACHILIPATNAM", "ULB CODE": 1070, "GRADE": "Corp", "AREA IN SQKM": 25.09, "HOUSE HOLD": 45569, "POPULATION (2011 CEN)": 169892, "ASSESSMENTS AS ON DATE \n 10-04-25": 52570, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 18, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KONASEEMA", "ULB NAME": "MANDAPETA", "ULB CODE": 1061, "GRADE": "II", "AREA IN SQKM": 21.5, "HOUSE HOLD": 15333, "POPULATION (2011 CEN)": 53633, "ASSESSMENTS AS ON DATE \n 10-04-25": 15465, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 19, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "NTR", "ULB NAME": "NANDIGAMA", "ULB CODE": 1145, "GRADE": "NP", "AREA IN SQKM": 31.86, "HOUSE HOLD": 11575, "POPULATION (2011 CEN)": 44359, "ASSESSMENTS AS ON DATE \n 10-04-25": 13754, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 20, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "WEST GODAVARI", "ULB NAME": "NARSAPURAM", "ULB CODE": 1077, "GRADE": "I", "AREA IN SQKM": 11.9, "HOUSE HOLD": 15591, "POPULATION (2011 CEN)": 58770, "ASSESSMENTS AS ON DATE \n 10-04-25": 16802, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 21, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "EAST GODAVARI", "ULB NAME": "NIDADAVOLE", "ULB CODE": 1078, "GRADE": "II", "AREA IN SQKM": 14.4, "HOUSE HOLD": 10873, "POPULATION (2011 CEN)": 43809, "ASSESSMENTS AS ON DATE \n 10-04-25": 12718, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 22, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "ELURU", "ULB NAME": "NUZIVIDU", "ULB CODE": 1071, "GRADE": "II", "AREA IN SQKM": 29.77, "HOUSE HOLD": 13921, "POPULATION (2011 CEN)": 58590, "ASSESSMENTS AS ON DATE \n 10-04-25": 15315, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 23, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "WEST GODAVARI", "ULB NAME": "PALAKOLLU", "ULB CODE": 1079, "GRADE": "I", "AREA IN SQKM": 4.79, "HOUSE HOLD": 16752, "POPULATION (2011 CEN)": 98357, "ASSESSMENTS AS ON DATE \n 10-04-25": 17817, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 24, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KRISHNA", "ULB NAME": "PEDANA", "ULB CODE": 1072, "GRADE": "III", "AREA IN SQKM": 12.96, "HOUSE HOLD": 8700, "POPULATION (2011 CEN)": 30721, "ASSESSMENTS AS ON DATE \n 10-04-25": 7874, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 25, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KAKINADA", "ULB NAME": "RAMCHANDRAPURAM", "ULB CODE": 1065, "GRADE": "II", "AREA IN SQKM": 14.01, "HOUSE HOLD": 12641, "POPULATION (2011 CEN)": 43657, "ASSESSMENTS AS ON DATE \n 10-04-25": 13682, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 26, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KAKINADA", "ULB NAME": "SAMARLAKOTA", "ULB CODE": 1066, "GRADE": "II", "AREA IN SQKM": 39.49, "HOUSE HOLD": 16044, "POPULATION (2011 CEN)": 56864, "ASSESSMENTS AS ON DATE \n 10-04-25": 17012, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 27, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "NTR", "ULB NAME": "TIRUVURU", "ULB CODE": 1146, "GRADE": "NP", "AREA IN SQKM": 27.91, "HOUSE HOLD": 9100, "POPULATION (2011 CEN)": 34623, "ASSESSMENTS AS ON DATE \n 10-04-25": 9700, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 28, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "NTR", "ULB NAME": "VIJAYAWADA", "ULB CODE": 1073, "GRADE": "Corp", "AREA IN SQKM": 62.17, "HOUSE HOLD": 302001, "POPULATION (2011 CEN)": 1034358, "ASSESSMENTS AS ON DATE \n 10-04-25": 236394, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 29, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KRISHNA", "ULB NAME": "VUYYURU", "ULB CODE": 1144, "GRADE": "NP", "AREA IN SQKM": 11.74, "HOUSE HOLD": 11745, "POPULATION (2011 CEN)": 46490, "ASSESSMENTS AS ON DATE \n 10-04-25": 10591, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 30, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "ELURU", "ULB NAME": "AKIVIDU", "ULB CODE": 1188, "GRADE": "NP", "AREA IN SQKM": 22.58, "HOUSE HOLD": 6126, "POPULATION (2011 CEN)": 32412, "ASSESSMENTS AS ON DATE \n 10-04-25": 8216, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 31, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "ELURU", "ULB NAME": "CHINTALAPUDI", "ULB CODE": 1193, "GRADE": "NP", "AREA IN SQKM": 39.36, "HOUSE HOLD": 8297, "POPULATION (2011 CEN)": 29952, "ASSESSMENTS AS ON DATE \n 10-04-25": 7354, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 32, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "NTR", "ULB NAME": "KONDAPALLI", "ULB CODE": 1187, "GRADE": "III", "AREA IN SQKM": 30.23, "HOUSE HOLD": 15865, "POPULATION (2011 CEN)": 63578, "ASSESSMENTS AS ON DATE \n 10-04-25": 14703, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 33, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "WEST GODAVARI", "ULB NAME": "BHIMAVARAM", "ULB CODE": 1074, "GRADE": "Selection", "AREA IN SQKM": 48.86, "HOUSE HOLD": 37848, "POPULATION (2011 CEN)": 142184, "ASSESSMENTS AS ON DATE \n 10-04-25": 40739, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 34, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KRISHNA", "ULB NAME": "YSR TADIGADAPA", "ULB CODE": 1192, "GRADE": "I", "AREA IN SQKM": 30.73, "HOUSE HOLD": 46958, "POPULATION (2011 CEN)": 126190, "ASSESSMENTS AS ON DATE \n 10-04-25": 48006, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 35, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "ELURU", "ULB NAME": "ELURU", "ULB CODE": 1075, "GRADE": "Corp", "AREA IN SQKM": 64.54, "HOUSE HOLD": 55014, "POPULATION (2011 CEN)": 271651, "ASSESSMENTS AS ON DATE \n 10-04-25": 71438, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 46.05}, {"SL NO": 36, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KRISHNA", "ULB NAME": "GUDIWADA", "ULB CODE": 1068, "GRADE": "Special", "AREA IN SQKM": 50.11, "HOUSE HOLD": 30808, "POPULATION (2011 CEN)": 139574, "ASSESSMENTS AS ON DATE \n 10-04-25": 29384, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 37, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "WEST GODAVARI", "ULB NAME": "TADEPALLIGUDEM", "ULB CODE": 1080, "GRADE": "Selection", "AREA IN SQKM": 51.71, "HOUSE HOLD": 27192, "POPULATION (2011 CEN)": 118891, "ASSESSMENTS AS ON DATE \n 10-04-25": 27587, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 38, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KAKINADA", "ULB NAME": "YELESWARAM", "ULB CODE": 1140, "GRADE": "NP", "AREA IN SQKM": 14.96, "HOUSE HOLD": 7982, "POPULATION (2011 CEN)": 32084, "ASSESSMENTS AS ON DATE \n 10-04-25": 7317, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 39, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KAKINADA", "ULB NAME": "PITHAPURAM", "ULB CODE": 1063, "GRADE": "II", "AREA IN SQKM": 19.59, "HOUSE HOLD": 14398, "POPULATION (2011 CEN)": 52360, "ASSESSMENTS AS ON DATE \n 10-04-25": 15903, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 40, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KAKINADA", "ULB NAME": "GOLLAPROLU", "ULB CODE": 1138, "GRADE": "NP", "AREA IN SQKM": 15.81, "HOUSE HOLD": 6784, "POPULATION (2011 CEN)": 23882, "ASSESSMENTS AS ON DATE \n 10-04-25": 6033, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 41, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "WEST GODAVARI", "ULB NAME": "TANUKU", "ULB CODE": 1081, "GRADE": "I", "AREA IN SQKM": 25.34, "HOUSE HOLD": 24444, "POPULATION (2011 CEN)": 90430, "ASSESSMENTS AS ON DATE \n 10-04-25": 24978, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 42, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KONASEEMA", "ULB NAME": "MUMMIDIVARAM", "ULB CODE": 1139, "GRADE": "NP", "AREA IN SQKM": 26, "HOUSE HOLD": 6339, "POPULATION (2011 CEN)": 25355, "ASSESSMENTS AS ON DATE \n 10-04-25": 6278, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 43, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "ELURU", "ULB NAME": "JANGAREDDYGUDEM", "ULB CODE": 1142, "GRADE": "II", "AREA IN SQKM": 24.78, "HOUSE HOLD": 12234, "POPULATION (2011 CEN)": 48994, "ASSESSMENTS AS ON DATE \n 10-04-25": 19141, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 44, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "EAST GODAVARI", "ULB NAME": "RAJAHMUNDRY", "ULB CODE": 1064, "GRADE": "Corp", "AREA IN SQKM": 25.86, "HOUSE HOLD": 94994, "POPULATION (2011 CEN)": 579802, "ASSESSMENTS AS ON DATE \n 10-04-25": 87262, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 45, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KAKINADA", "ULB NAME": "TUNI", "ULB CODE": 1067, "GRADE": "II", "AREA IN SQKM": 7.82, "HOUSE HOLD": 14439, "POPULATION (2011 CEN)": 53425, "ASSESSMENTS AS ON DATE \n 10-04-25": 13012, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 46, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "NTR", "ULB NAME": "JAGGAIAHPET", "ULB CODE": 1069, "GRADE": "II", "AREA IN SQKM": 39.09, "HOUSE HOLD": 13373, "POPULATION (2011 CEN)": 53530, "ASSESSMENTS AS ON DATE \n 10-04-25": 13901, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 47, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KAKINADA", "ULB NAME": "KAKINADA", "ULB CODE": 1060, "GRADE": "Corp", "AREA IN SQKM": 31.27, "HOUSE HOLD": 101014, "POPULATION (2011 CEN)": 325855, "ASSESSMENTS AS ON DATE \n 10-04-25": 88788, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 20}, {"SL NO": 48, "REGION": "RAJAHMANDRY", "DISRTICT NAME": "KAKINADA", "ULB NAME": "PEDDAPURAM", "ULB CODE": 1062, "GRADE": "II", "AREA IN SQKM": 41.35, "HOUSE HOLD": 11500, "POPULATION (2011 CEN)": 49477, "ASSESSMENTS AS ON DATE \n 10-04-25": 14355, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 49, "REGION": "GUNTUR", "DISRTICT NAME": "ONGOLE", "ULB NAME": "CHIMAKURTHY", "ULB CODE": 1149, "GRADE": "NP", "AREA IN SQKM": 28.45, "HOUSE HOLD": 7544, "POPULATION (2011 CEN)": 30279, "ASSESSMENTS AS ON DATE \n 10-04-25": 7315, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 50, "REGION": "GUNTUR", "DISRTICT NAME": "PRAKASHAM", "ULB NAME": "GIDDALUR", "ULB CODE": 1148, "GRADE": "NP", "AREA IN SQKM": 33.12, "HOUSE HOLD": 11292, "POPULATION (2011 CEN)": 37674, "ASSESSMENTS AS ON DATE \n 10-04-25": 12497, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 51, "REGION": "GUNTUR", "DISRTICT NAME": "PRAKASHAM", "ULB NAME": "ONGOLE", "ULB CODE": 1035, "GRADE": "Corp", "AREA IN SQKM": 129.8, "HOUSE HOLD": 61694, "POPULATION (2011 CEN)": 251175, "ASSESSMENTS AS ON DATE \n 10-04-25": 66069, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 101.43}, {"SL NO": 52, "REGION": "GUNTUR", "DISRTICT NAME": "GUNTUR", "ULB NAME": "TENALI", "ULB CODE": 1028, "GRADE": "Special", "AREA IN SQKM": 16.97, "HOUSE HOLD": 43593, "POPULATION (2011 CEN)": 164937, "ASSESSMENTS AS ON DATE \n 10-04-25": 39898, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 53, "REGION": "GUNTUR", "DISRTICT NAME": "TIRUPATI", "ULB NAME": "VENKATAGIRI", "ULB CODE": 1127, "GRADE": "III", "AREA IN SQKM": 23.47, "HOUSE HOLD": 12984, "POPULATION (2011 CEN)": 51708, "ASSESSMENTS AS ON DATE \n 10-04-25": 14241, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 54, "REGION": "GUNTUR", "DISRTICT NAME": "GUNTUR", "ULB NAME": "MANGALAGIRI TADEPALLI", "ULB CODE": 1023, "GRADE": "Corp", "AREA IN SQKM": 191.22, "HOUSE HOLD": 37547, "POPULATION (2011 CEN)": 253831, "ASSESSMENTS AS ON DATE \n 10-04-25": 88575, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 150.86}, {"SL NO": 55, "REGION": "GUNTUR", "DISRTICT NAME": "SPSR NELLORE", "ULB NAME": "BUCHIREDDIPALEM", "ULB CODE": 1185, "GRADE": "NP", "AREA IN SQKM": 23.59, "HOUSE HOLD": 8534, "POPULATION (2011 CEN)": 38405, "ASSESSMENTS AS ON DATE \n 10-04-25": 9697, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 56, "REGION": "GUNTUR", "DISRTICT NAME": "PALNADU", "ULB NAME": "DACHEPALLI", "ULB CODE": 1183, "GRADE": "NP", "AREA IN SQKM": 57.73, "HOUSE HOLD": 11476, "POPULATION (2011 CEN)": 36590, "ASSESSMENTS AS ON DATE \n 10-04-25": 10868, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 57, "REGION": "GUNTUR", "DISRTICT NAME": "PALNADU", "ULB NAME": "CHILAKALURIPETA", "ULB CODE": 1020, "GRADE": "I", "AREA IN SQKM": 73.08, "HOUSE HOLD": 24789, "POPULATION (2011 CEN)": 131761, "ASSESSMENTS AS ON DATE \n 10-04-25": 32674, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 58, "REGION": "GUNTUR", "DISRTICT NAME": "SPSR NELLORE", "ULB NAME": "KANDUKURU", "ULB CODE": 1033, "GRADE": "II", "AREA IN SQKM": 61.38, "HOUSE HOLD": 15407, "POPULATION (2011 CEN)": 60672, "ASSESSMENTS AS ON DATE \n 10-04-25": 17306, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 59, "REGION": "GUNTUR", "DISRTICT NAME": "SPSR NELLORE", "ULB NAME": "ALLUR", "ULB CODE": 1190, "GRADE": "NP", "AREA IN SQKM": 91.22, "HOUSE HOLD": 1579, "POPULATION (2011 CEN)": 26392, "ASSESSMENTS AS ON DATE \n 10-04-25": 7308, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 60, "REGION": "GUNTUR", "DISRTICT NAME": "PRAKASAM", "ULB NAME": "PODILI", "ULB CODE": 1191, "GRADE": "NP", "AREA IN SQKM": 81.22, "HOUSE HOLD": 11800, "POPULATION (2011 CEN)": 38489, "ASSESSMENTS AS ON DATE \n 10-04-25": 11290, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 61, "REGION": "GUNTUR", "DISRTICT NAME": "BAPATLA", "ULB NAME": "REPALLE", "ULB CODE": 1026, "GRADE": "II", "AREA IN SQKM": 10.96, "HOUSE HOLD": 12664, "POPULATION (2011 CEN)": 50866, "ASSESSMENTS AS ON DATE \n 10-04-25": 10778, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 62, "REGION": "GUNTUR", "DISRTICT NAME": "PALNADU", "ULB NAME": "MACHERLA", "ULB CODE": 1022, "GRADE": "II", "AREA IN SQKM": 32.05, "HOUSE HOLD": 14605, "POPULATION (2011 CEN)": 57290, "ASSESSMENTS AS ON DATE \n 10-04-25": 15968, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 63, "REGION": "GUNTUR", "DISRTICT NAME": "PRAKASAM", "ULB NAME": "DARSI", "ULB CODE": 1186, "GRADE": "NP", "AREA IN SQKM": 46.66, "HOUSE HOLD": 7429, "POPULATION (2011 CEN)": 33418, "ASSESSMENTS AS ON DATE \n 10-04-25": 9722, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 64, "REGION": "GUNTUR", "DISRTICT NAME": "TIRUPATI", "ULB NAME": "GUDUR,TIRUPATI", "ULB CODE": 1029, "GRADE": "I", "AREA IN SQKM": 80.4, "HOUSE HOLD": 6972, "POPULATION (2011 CEN)": 93191, "ASSESSMENTS AS ON DATE \n 10-04-25": 18406, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 65, "REGION": "GUNTUR", "DISRTICT NAME": "PRAKASAM", "ULB NAME": "MARKAPUR", "ULB CODE": 1034, "GRADE": "II", "AREA IN SQKM": 23.75, "HOUSE HOLD": 17464, "POPULATION (2011 CEN)": 71092, "ASSESSMENTS AS ON DATE \n 10-04-25": 18345, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 66, "REGION": "GUNTUR", "DISRTICT NAME": "GUNTUR", "ULB NAME": "GUNTUR", "ULB CODE": 1021, "GRADE": "Corp", "AREA IN SQKM": 143.18, "HOUSE HOLD": 189559, "POPULATION (2011 CEN)": 743880, "ASSESSMENTS AS ON DATE \n 10-04-25": 212385, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 38.05}, {"SL NO": 67, "REGION": "GUNTUR", "DISRTICT NAME": "PRAKASAM", "ULB NAME": "KANIGIRI", "ULB CODE": 1150, "GRADE": "NP", "AREA IN SQKM": 54.04, "HOUSE HOLD": 10465, "POPULATION (2011 CEN)": 44755, "ASSESSMENTS AS ON DATE \n 10-04-25": 9991, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 68, "REGION": "GUNTUR", "DISRTICT NAME": "SPSR NELLORE", "ULB NAME": "KAVALI", "ULB CODE": 1030, "GRADE": "I", "AREA IN SQKM": 71.99, "HOUSE HOLD": 25945, "POPULATION (2011 CEN)": 97750, "ASSESSMENTS AS ON DATE \n 10-04-25": 27631, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 69, "REGION": "GUNTUR", "DISRTICT NAME": "TIRUPATI", "ULB NAME": "SULLURPETA", "ULB CODE": 1152, "GRADE": "III", "AREA IN SQKM": 22.36, "HOUSE HOLD": 11850, "POPULATION (2011 CEN)": 47130, "ASSESSMENTS AS ON DATE \n 10-04-25": 12947, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 70, "REGION": "GUNTUR", "DISRTICT NAME": "GUNTUR", "ULB NAME": "PONNUR", "ULB CODE": 1025, "GRADE": "II", "AREA IN SQKM": 42.98, "HOUSE HOLD": 16117, "POPULATION (2011 CEN)": 74517, "ASSESSMENTS AS ON DATE \n 10-04-25": 15948, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 71, "REGION": "GUNTUR", "DISRTICT NAME": "BAPATLA", "ULB NAME": "BAPATLA", "ULB CODE": 1019, "GRADE": "I", "AREA IN SQKM": 64.95, "HOUSE HOLD": 22465, "POPULATION (2011 CEN)": 88961, "ASSESSMENTS AS ON DATE \n 10-04-25": 24478, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 72, "REGION": "GUNTUR", "DISRTICT NAME": "SPSR NELLORE", "ULB NAME": "NELLORE", "ULB CODE": 1031, "GRADE": "Corp", "AREA IN SQKM": 150.7, "HOUSE HOLD": 141568, "POPULATION (2011 CEN)": 591644, "ASSESSMENTS AS ON DATE \n 10-04-25": 144033, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 51.04}, {"SL NO": 73, "REGION": "GUNTUR", "DISRTICT NAME": "BAPATLA", "ULB NAME": "ADANKI", "ULB CODE": 1147, "GRADE": "NP", "AREA IN SQKM": 27.96, "HOUSE HOLD": 10391, "POPULATION (2011 CEN)": 40353, "ASSESSMENTS AS ON DATE \n 10-04-25": 11504, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 74, "REGION": "GUNTUR", "DISRTICT NAME": "NELLORE", "ULB NAME": "ATMAKUR,NELLORE", "ULB CODE": 1151, "GRADE": "III", "AREA IN SQKM": 60.19, "HOUSE HOLD": 10076, "POPULATION (2011 CEN)": 30556, "ASSESSMENTS AS ON DATE \n 10-04-25": 8857, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 75, "REGION": "GUNTUR", "DISRTICT NAME": "BAPATLA", "ULB NAME": "CHIRALA", "ULB CODE": 1032, "GRADE": "I", "AREA IN SQKM": 13.31, "HOUSE HOLD": 21253, "POPULATION (2011 CEN)": 87200, "ASSESSMENTS AS ON DATE \n 10-04-25": 24934, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 76, "REGION": "GUNTUR", "DISRTICT NAME": "PALNADU", "ULB NAME": "GURAJALA", "ULB CODE": 1184, "GRADE": "NP", "AREA IN SQKM": 43.72, "HOUSE HOLD": 7123, "POPULATION (2011 CEN)": 26190, "ASSESSMENTS AS ON DATE \n 10-04-25": 8262, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 77, "REGION": "GUNTUR", "DISRTICT NAME": "PALNADU", "ULB NAME": "NARSARAOPET", "ULB CODE": 1024, "GRADE": "I", "AREA IN SQKM": 15.07, "HOUSE HOLD": 29696, "POPULATION (2011 CEN)": 125123, "ASSESSMENTS AS ON DATE \n 10-04-25": 29043, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 78, "REGION": "GUNTUR", "DISRTICT NAME": "PALNADU", "ULB NAME": "PIDUGURALLA", "ULB CODE": 1132, "GRADE": "II", "AREA IN SQKM": 31.97, "HOUSE HOLD": 15596, "POPULATION (2011 CEN)": 63103, "ASSESSMENTS AS ON DATE \n 10-04-25": 16439, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 79, "REGION": "GUNTUR", "DISRTICT NAME": "PALNADU", "ULB NAME": "SATTENAPALLE", "ULB CODE": 1027, "GRADE": "II", "AREA IN SQKM": 21.93, "HOUSE HOLD": 14618, "POPULATION (2011 CEN)": 56721, "ASSESSMENTS AS ON DATE \n 10-04-25": 17268, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 80, "REGION": "GUNTUR", "DISRTICT NAME": "PALNADU", "ULB NAME": "VINUKONDA", "ULB CODE": 1131, "GRADE": "II", "AREA IN SQKM": 24.16, "HOUSE HOLD": 14923, "POPULATION (2011 CEN)": 59725, "ASSESSMENTS AS ON DATE \n 10-04-25": 15742, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 81, "REGION": "GUNTUR", "DISRTICT NAME": "TIRUPATI", "ULB NAME": "NAIDUPET", "ULB CODE": 1153, "GRADE": "III", "AREA IN SQKM": 26.27, "HOUSE HOLD": 12659, "POPULATION (2011 CEN)": 49778, "ASSESSMENTS AS ON DATE \n 10-04-25": 13031, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 82, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANANTAPUR", "ULB NAME": "ANANTHAPUR", "ULB CODE": 1001, "GRADE": "Corp", "AREA IN SQKM": 16.4, "HOUSE HOLD": 62991, "POPULATION (2011 CEN)": 261004, "ASSESSMENTS AS ON DATE \n 10-04-25": 59971, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 16.31}, {"SL NO": 83, "REGION": "ANANTHAPUR", "DISRTICT NAME": "KURNOOL", "ULB NAME": "GUDUR,KURNOOL", "ULB CODE": 1163, "GRADE": "NP", "AREA IN SQKM": 47.61, "HOUSE HOLD": 6972, "POPULATION (2011 CEN)": 22270, "ASSESSMENTS AS ON DATE \n 10-04-25": 5531, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 84, "REGION": "ANANTHAPUR", "DISRTICT NAME": "SRI SATYA SAI", "ULB NAME": "KADIRI", "ULB CODE": 1005, "GRADE": "Special", "AREA IN SQKM": 43.3, "HOUSE HOLD": 20106, "POPULATION (2011 CEN)": 89429, "ASSESSMENTS AS ON DATE \n 10-04-25": 22885, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 85, "REGION": "ANANTHAPUR", "DISRTICT NAME": "SRI SATYA SAI", "ULB NAME": "MADAKASIRA", "ULB CODE": 1154, "GRADE": "NP", "AREA IN SQKM": 34.92, "HOUSE HOLD": 5386, "POPULATION (2011 CEN)": 21464, "ASSESSMENTS AS ON DATE \n 10-04-25": 7386, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 86, "REGION": "ANANTHAPUR", "DISRTICT NAME": "YSR KADAPA", "ULB NAME": "MYDUKUR", "ULB CODE": 1164, "GRADE": "III", "AREA IN SQKM": 57.7, "HOUSE HOLD": 11818, "POPULATION (2011 CEN)": 45790, "ASSESSMENTS AS ON DATE \n 10-04-25": 13488, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 87, "REGION": "ANANTHAPUR", "DISRTICT NAME": "NANDYALA", "ULB NAME": "NANDIKOTKUR", "ULB CODE": 1161, "GRADE": "II", "AREA IN SQKM": 23.26, "HOUSE HOLD": 14726, "POPULATION (2011 CEN)": 46953, "ASSESSMENTS AS ON DATE \n 10-04-25": 16872, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 88, "REGION": "ANANTHAPUR", "DISRTICT NAME": "SRI SATYA SAI", "ULB NAME": "PUTTAPARTHI", "ULB CODE": 1155, "GRADE": "NP", "AREA IN SQKM": 58.99, "HOUSE HOLD": 11044, "POPULATION (2011 CEN)": 30782, "ASSESSMENTS AS ON DATE \n 10-04-25": 14474, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 89, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANANTAPUR", "ULB NAME": "RAYADURGAM", "ULB CODE": 1006, "GRADE": "II", "AREA IN SQKM": 38.93, "HOUSE HOLD": 14471, "POPULATION (2011 CEN)": 61749, "ASSESSMENTS AS ON DATE \n 10-04-25": 18884, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 90, "REGION": "ANANTHAPUR", "DISRTICT NAME": "TIRUPATI", "ULB NAME": "TIRUPATI", "ULB CODE": 1012, "GRADE": "Corp", "AREA IN SQKM": 28.29, "HOUSE HOLD": 91811, "POPULATION (2011 CEN)": 374260, "ASSESSMENTS AS ON DATE \n 10-04-25": 77137, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 20}, {"SL NO": 91, "REGION": "ANANTHAPUR", "DISRTICT NAME": "NANDYALA", "ULB NAME": "BETHAMCHERLA", "ULB CODE": 1182, "GRADE": "NP", "AREA IN SQKM": 24.3, "HOUSE HOLD": 8754, "POPULATION (2011 CEN)": 39226, "ASSESSMENTS AS ON DATE \n 10-04-25": 12320, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 92, "REGION": "ANANTHAPUR", "DISRTICT NAME": "CHITTOOR", "ULB NAME": "KUPPAM", "ULB CODE": 1180, "GRADE": "III", "AREA IN SQKM": 33.21, "HOUSE HOLD": 10387, "POPULATION (2011 CEN)": 46598, "ASSESSMENTS AS ON DATE \n 10-04-25": 13048, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 34.55}, {"SL NO": 93, "REGION": "ANANTHAPUR", "DISRTICT NAME": "YSR KADAPA", "ULB NAME": "PRODDUTUR", "ULB CODE": 1014, "GRADE": "Special", "AREA IN SQKM": 7.09, "HOUSE HOLD": 38350, "POPULATION (2011 CEN)": 162717, "ASSESSMENTS AS ON DATE \n 10-04-25": 34500, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 94, "REGION": "ANANTHAPUR", "DISRTICT NAME": "YSR KADAPA", "ULB NAME": "PULLIVENDULA", "ULB CODE": 1122, "GRADE": "II", "AREA IN SQKM": 89.41, "HOUSE HOLD": 13513, "POPULATION (2011 CEN)": 65706, "ASSESSMENTS AS ON DATE \n 10-04-25": 23253, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 95, "REGION": "ANANTHAPUR", "DISRTICT NAME": "NANDYALA", "ULB NAME": "DHONE", "ULB CODE": 1125, "GRADE": "II", "AREA IN SQKM": 10.49, "HOUSE HOLD": 12850, "POPULATION (2011 CEN)": 59272, "ASSESSMENTS AS ON DATE \n 10-04-25": 17963, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 96, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANNAMAYYA", "ULB NAME": "RAYACHOTI", "ULB CODE": 1121, "GRADE": "I", "AREA IN SQKM": 26.94, "HOUSE HOLD": 20536, "POPULATION (2011 CEN)": 91234, "ASSESSMENTS AS ON DATE \n 10-04-25": 29216, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 97, "REGION": "ANANTHAPUR", "DISRTICT NAME": "CHITTOOR", "ULB NAME": "CHITTOOR", "ULB CODE": 1008, "GRADE": "Corp", "AREA IN SQKM": 113.54, "HOUSE HOLD": 54693, "POPULATION (2011 CEN)": 196601, "ASSESSMENTS AS ON DATE \n 10-04-25": 44968, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 98, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANNAMAYYA", "ULB NAME": "BEERANGI KOTHAKOTA", "ULB CODE": 1189, "GRADE": "NP", "AREA IN SQKM": 40.2, "HOUSE HOLD": "", "POPULATION (2011 CEN)": 25536, "ASSESSMENTS AS ON DATE \n 10-04-25": 7768, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 99, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANNAMAYYA", "ULB NAME": "RAJAMPET", "ULB CODE": 1120, "GRADE": "II", "AREA IN SQKM": 5.81, "HOUSE HOLD": 11500, "POPULATION (2011 CEN)": 47220, "ASSESSMENTS AS ON DATE \n 10-04-25": 12087, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 100, "REGION": "ANANTHAPUR", "DISRTICT NAME": "YSR KADAPA", "ULB NAME": "YERRAGUNTLA", "ULB CODE": 1165, "GRADE": "NP", "AREA IN SQKM": 13.7, "HOUSE HOLD": 10502, "POPULATION (2011 CEN)": 32574, "ASSESSMENTS AS ON DATE \n 10-04-25": 11506, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 101, "REGION": "ANANTHAPUR", "DISRTICT NAME": "YSR KADAPA", "ULB NAME": "JAMMALAMADUGU", "ULB CODE": 1124, "GRADE": "NP", "AREA IN SQKM": 24.73, "HOUSE HOLD": 12516, "POPULATION (2011 CEN)": 46069, "ASSESSMENTS AS ON DATE \n 10-04-25": 11935, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 102, "REGION": "ANANTHAPUR", "DISRTICT NAME": "NANDYALA", "ULB NAME": "NANDYAL", "ULB CODE": 1017, "GRADE": "Special", "AREA IN SQKM": 59.19, "HOUSE HOLD": 67155, "POPULATION (2011 CEN)": 214608, "ASSESSMENTS AS ON DATE \n 10-04-25": 52077, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 103, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANANTAPUR", "ULB NAME": "TADIPATRI", "ULB CODE": 1007, "GRADE": "Special", "AREA IN SQKM": 7.85, "HOUSE HOLD": 30415, "POPULATION (2011 CEN)": 108171, "ASSESSMENTS AS ON DATE \n 10-04-25": 26601, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 104, "REGION": "ANANTHAPUR", "DISRTICT NAME": "NANDYALA", "ULB NAME": "ATMAKUR,NANDYALA", "ULB CODE": 1160, "GRADE": "III", "AREA IN SQKM": 27.81, "HOUSE HOLD": 10076, "POPULATION (2011 CEN)": 45703, "ASSESSMENTS AS ON DATE \n 10-04-25": 11904, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 105, "REGION": "ANANTHAPUR", "DISRTICT NAME": "TIRUPATI", "ULB NAME": "PUTTUR,TIRUPATI", "ULB CODE": 1119, "GRADE": "III", "AREA IN SQKM": 35.6, "HOUSE HOLD": 13477, "POPULATION (2011 CEN)": 54092, "ASSESSMENTS AS ON DATE \n 10-04-25": 13891, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 106, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANANTAPUR", "ULB NAME": "GUNTAKAL", "ULB CODE": 1003, "GRADE": "Selection", "AREA IN SQKM": 40.47, "HOUSE HOLD": 27392, "POPULATION (2011 CEN)": 126270, "ASSESSMENTS AS ON DATE \n 10-04-25": 31491, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 107, "REGION": "ANANTHAPUR", "DISRTICT NAME": "YSR KADAPA", "ULB NAME": "KAMALAPURAM", "ULB CODE": 1181, "GRADE": "NP", "AREA IN SQKM": 21.92, "HOUSE HOLD": 4598, "POPULATION (2011 CEN)": 20414, "ASSESSMENTS AS ON DATE \n 10-04-25": 5606, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 108, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANANTAPUR", "ULB NAME": "GOOTY", "ULB CODE": 1156, "GRADE": "III", "AREA IN SQKM": 34.92, "HOUSE HOLD": 11320, "POPULATION (2011 CEN)": 48838, "ASSESSMENTS AS ON DATE \n 10-04-25": 14150, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 109, "REGION": "ANANTHAPUR", "DISRTICT NAME": "KURNOOL", "ULB NAME": "YEMMIGANUR", "ULB CODE": 1018, "GRADE": "I", "AREA IN SQKM": 17.2, "HOUSE HOLD": 22854, "POPULATION (2011 CEN)": 95149, "ASSESSMENTS AS ON DATE \n 10-04-25": 25529, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 110, "REGION": "ANANTHAPUR", "DISRTICT NAME": "SRI SATYA SAI", "ULB NAME": "DHARMAVARAM", "ULB CODE": 1002, "GRADE": "Selection", "AREA IN SQKM": 41.84, "HOUSE HOLD": 30099, "POPULATION (2011 CEN)": 126958, "ASSESSMENTS AS ON DATE \n 10-04-25": 35698, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 111, "REGION": "ANANTHAPUR", "DISRTICT NAME": "CHITTOOR", "ULB NAME": "PALAMANER", "ULB CODE": 1117, "GRADE": "III", "AREA IN SQKM": 14.29, "HOUSE HOLD": 12233, "POPULATION (2011 CEN)": 51163, "ASSESSMENTS AS ON DATE \n 10-04-25": 13448, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 112, "REGION": "ANANTHAPUR", "DISRTICT NAME": "SRI SATYA SAI", "ULB NAME": "HINDUPUR", "ULB CODE": 1004, "GRADE": "Selection", "AREA IN SQKM": 38.5, "HOUSE HOLD": 37769, "POPULATION (2011 CEN)": 151677, "ASSESSMENTS AS ON DATE \n 10-04-25": 40557, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 113, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANNAMAYYA", "ULB NAME": "MADANAPALLE", "ULB CODE": 1009, "GRADE": "Selection", "AREA IN SQKM": 14.4, "HOUSE HOLD": 34713, "POPULATION (2011 CEN)": 136414, "ASSESSMENTS AS ON DATE \n 10-04-25": 28111, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 114, "REGION": "ANANTHAPUR", "DISRTICT NAME": "SRI SATYA SAI", "ULB NAME": "PENUKONDA", "ULB CODE": 1179, "GRADE": "NP", "AREA IN SQKM": 73.46, "HOUSE HOLD": 9295, "POPULATION (2011 CEN)": 27382, "ASSESSMENTS AS ON DATE \n 10-04-25": 8531, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 115, "REGION": "ANANTHAPUR", "DISRTICT NAME": "NANDYALA", "ULB NAME": "ALLAGADDA", "ULB CODE": 1162, "GRADE": "II", "AREA IN SQKM": 62.38, "HOUSE HOLD": 13133, "POPULATION (2011 CEN)": 42404, "ASSESSMENTS AS ON DATE \n 10-04-25": 16002, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 116, "REGION": "ANANTHAPUR", "DISRTICT NAME": "CHITTOOR", "ULB NAME": "PUNGANUR", "ULB CODE": 1010, "GRADE": "II", "AREA IN SQKM": 16.06, "HOUSE HOLD": 12767, "POPULATION (2011 CEN)": 56223, "ASSESSMENTS AS ON DATE \n 10-04-25": 13646, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 117, "REGION": "ANANTHAPUR", "DISRTICT NAME": "KURNOOL", "ULB NAME": "ADONI", "ULB CODE": 1015, "GRADE": "Special", "AREA IN SQKM": 32.37, "HOUSE HOLD": 33071, "POPULATION (2011 CEN)": 166344, "ASSESSMENTS AS ON DATE \n 10-04-25": 36405, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 118, "REGION": "ANANTHAPUR", "DISRTICT NAME": "ANANTAPUR", "ULB NAME": "KALYANADURGAM", "ULB CODE": 1158, "GRADE": "III", "AREA IN SQKM": 64.24, "HOUSE HOLD": 11492, "POPULATION (2011 CEN)": 44959, "ASSESSMENTS AS ON DATE \n 10-04-25": 13094, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 119, "REGION": "ANANTHAPUR", "DISRTICT NAME": "KURNOOL", "ULB NAME": "KURNOOL", "ULB CODE": 1016, "GRADE": "Corp", "AREA IN SQKM": 116.53, "HOUSE HOLD": 102077, "POPULATION (2011 CEN)": 476540, "ASSESSMENTS AS ON DATE \n 10-04-25": 121269, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": 48.67}, {"SL NO": 120, "REGION": "ANANTHAPUR", "DISRTICT NAME": "TIRUPATI", "ULB NAME": "SRIKALAHASTI", "ULB CODE": 1011, "GRADE": "I", "AREA IN SQKM": 57.02, "HOUSE HOLD": 19618, "POPULATION (2011 CEN)": 90692, "ASSESSMENTS AS ON DATE \n 10-04-25": 22880, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 121, "REGION": "ANANTHAPUR", "DISRTICT NAME": "CHITTOOR", "ULB NAME": "NAGARI", "ULB CODE": 1118, "GRADE": "III", "AREA IN SQKM": 30.95, "HOUSE HOLD": 14259, "POPULATION (2011 CEN)": 62253, "ASSESSMENTS AS ON DATE \n 10-04-25": 14693, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 122, "REGION": "ANANTHAPUR", "DISRTICT NAME": "YSR KADAPA", "ULB NAME": "KADAPA", "ULB CODE": 1013, "GRADE": "Corp", "AREA IN SQKM": 164.06, "HOUSE HOLD": 84173, "POPULATION (2011 CEN)": 343054, "ASSESSMENTS AS ON DATE \n 10-04-25": 102332, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}, {"SL NO": 123, "REGION": "ANANTHAPUR", "DISRTICT NAME": "YSR KADAPA", "ULB NAME": "BADVEL", "ULB CODE": 1123, "GRADE": "II", "AREA IN SQKM": 52.41, "HOUSE HOLD": 24423, "POPULATION (2011 CEN)": 70626, "ASSESSMENTS AS ON DATE \n 10-04-25": 25117, "NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)": ""}];

/* Fallback if you haven't pasted data yet */
const rawDataSafe = (typeof rawData !== 'undefined' && Array.isArray(rawData)) ? rawData : [];

/* Normalize column names and parse numbers */
const data = rawDataSafe.map(d => ({
  sl_no: d['SL NO'] || d['Sl No'] || null,
  region: d['REGION'] || d['Region'] || '',
  district: d['DISRTICT NAME'] || d['DISTRICT NAME'] || d['DISRTICT NAME'] || '',
  ulb: d['ULB NAME'] || '',
  ulb_code: (d['ULB CODE']) ? String(d['ULB CODE']) : '',
  grade: d['GRADE'] || '',
  area_sqkm: parseFloat(String(d['AREA IN SQKM']||0) || 0) || 0,
  households: (d['HOUSE HOLD'] === "" || d['HOUSE HOLD'] === null) ? null : Number(d['HOUSE HOLD']),
  population: (d['POPULATION (2011 CEN)'] === "" || d['POPULATION (2011 CEN)'] === null) ? null : Number(d['POPULATION (2011 CEN)']),
  assessments: (d['ASSESSMENTS AS ON DATE \\n 10-04-25'] === undefined)
    ? (Number(d['ASSESSMENTS AS ON DATE \n 10-04-25'] || d['ASSESSMENTS AS ON DATE'] || 0))
    : Number(d['ASSESSMENTS AS ON DATE \\n 10-04-25']||0),
  naksha_area: (d['NAKSHA PROJECT AREA FOR FIELD SURVEY \\n (SQ KM)'] === undefined)
    ? (d['NAKSHA PROJECT AREA FOR FIELD SURVEY \n (SQ KM)']||'')
    : (d['NAKSHA PROJECT AREA FOR FIELD SURVEY \\n (SQ KM)']||'')
}));

/* State and utilities */
const uiState = { grade: null, district: null, tableSort: { key: 'ulb', dir: 'asc' }, tableSearch: '' };
const nf0 = new Intl.NumberFormat(), nf2 = new Intl.NumberFormat('en-IN', { maximumFractionDigits: 2 });
const sum = (arr,k)=>arr.reduce((s,r)=>s+(isFinite(r[k])?(r[k]||0):0),0);
const countUnique = (arr,k)=>new Set(arr.map(d=>d[k]).filter(x=>x!==''&&x!=null)).size;
const sortByULBAsc = arr=>arr.slice().sort((a,b)=>String(a.ulb).localeCompare(String(b.ulb)));
function scaleSize(val,minV,maxV,minS=6,maxS=40){ if(!isFinite(val))return minS; if(maxV<=minV)return (minS+maxS)/2; return minS+((val-minV)/(maxV-minV))*(maxS-minS); }

/* Filters and UI wiring */
const regionFilter=document.getElementById('regionFilter');
const searchBox=document.getElementById('searchBox');
const resetBtn=document.getElementById('resetBtn');
Array.from(new Set(data.map(d=>d.region))).sort().forEach(r=>{ if(r){ const o=document.createElement('option'); o.value=r; o.text=r; regionFilter.appendChild(o);} });

function getFilteredData(){
  const region=regionFilter.value, code=searchBox.value.trim();
  let out=data.slice();
  if(region) out=out.filter(d=>d.region===region);
  if(code) out=out.filter(d=>String(d.ulb_code)===String(code));
  if(uiState.grade) out=out.filter(d=>d.grade===uiState.grade);
  if(uiState.district) out=out.filter(d=>d.district===uiState.district);
  return out;
}

function updateKPIs(f){
  document.getElementById('kpiHouseholds').innerText=nf0.format(sum(f,'households'));
  document.getElementById('kpiAssessments').innerText=nf0.format(sum(f,'assessments'));
  document.getElementById('kpiPopulation').innerText=nf0.format(sum(f,'population'));
  document.getElementById('kpiArea').innerText=nf2.format(sum(f,'area_sqkm'));
  document.getElementById('kpiUlbs').innerText=countUnique(f,'ulb_code');
}

/* Grade pie: A–Z labels, legend at bottom, fits container height */
function updateGradePie(filtered){
  const groups={}; filtered.forEach(d=>{const g=d.grade||'Unknown'; groups[g]=(groups[g]||0)+1;});
  const labels=Object.keys(groups).sort((a,b)=>String(a).localeCompare(String(b)));
  const values=labels.map(l=>groups[l]);
  const pull=labels.map(l=>uiState.grade===l?0.12:0);

  const HEIGHT = document.getElementById('gradePie').clientHeight || 360;

  const trace={
    type:'pie',labels,values,pull,sort:false,
    textinfo:'label+percent',textposition:'inside',insidetextorientation:'radial',
    hoverinfo:'label+value+percent',
    domain:{x:[0,1],y:[0.22,1]} /* lift to make space for bottom legend */
  };
  const layout={
    height:HEIGHT,
    margin:{t:10,r:10,b:110,l:10},
    legend:{orientation:'h',y:0,yanchor:'top',x:0.5,xanchor:'center',font:{size:11}}
  };
  Plotly.react('gradePie',[trace],layout);
}

/* Assessments vs Households */
function updateAssessmentsBar(f){
  const arr=sortByULBAsc(f), names=arr.map(d=>d.ulb), asm=arr.map(d=>d.assessments||0), hh=arr.map(d=>d.households||0), cds=arr.map(d=>d.ulb_code);
  const t1={x:names,y:asm,type:'bar',name:'Assessments',customdata:cds,hovertemplate:'%{x}<br>Assessments: %{y:,}<extra></extra>'};
  const t2={x:names,y:hh,type:'bar',name:'Households',customdata:cds,hovertemplate:'%{x}<br>Households: %{y:,}<extra></extra>'};
  Plotly.react('assessmentsBar',[t1,t2],{barmode:'group',height:260,xaxis:{tickangle:-45,automargin:true},margin:{t:10,b:100,l:50,r:10},legend:{orientation:'h',y:1.15,x:0.5,xanchor:'center'}});
}

/* Area vs Population (bubble size & color by Area) */
function updateAreaVsPopulationScatter(f){
  const arr=sortByULBAsc(f.filter(d=>isFinite(d.area_sqkm)&&isFinite(d.population)&&d.population>0));
  const x=arr.map(d=>d.area_sqkm), y=arr.map(d=>d.population), cds=arr.map(d=>d.ulb_code), labels=arr.map(d=>d.ulb);
  const minA=Math.min(...x), maxA=Math.max(...x), sizes=x.map(a=>scaleSize(a,minA,maxA,6,40));
  const trace={x,y,mode:'markers',marker:{size:sizes,opacity:0.85,color:x,colorscale:'YlGnBu',cmin:minA,cmax:maxA,colorbar:{title:'Area (sqkm)'}},text:labels,customdata:cds,hovertemplate:'%{text} (%{customdata})<br>Area: %{x:.2f} sqkm<br>Population: %{y:,}<extra></extra>'};
  Plotly.react('scatter',[trace],{height:260,xaxis:{title:'Area (sqkm)',zeroline:false},yaxis:{title:'Population',zeroline:false},margin:{t:10,b:50,l:70,r:10}});
}

/* Population vs Assessments by District (A–Z) */
function updatePopulationBar(f){
  const by={}; f.forEach(d=>{const k=d.district||'Unknown'; by[k]||(by[k]={p:0,a:0}); by[k].p+=(isFinite(d.population)?d.population:0); by[k].a+=(isFinite(d.assessments)?d.assessments:0);});
  const dists=Object.keys(by).sort((a,b)=>String(a).localeCompare(String(b)));
  const pops=dists.map(k=>by[k].p), asmts=dists.map(k=>by[k].a);
  const tPop={x:dists,y:pops,type:'bar',name:'Population',marker:{color:'#2a9d8f'},hovertemplate:'%{x}<br>Population: %{y:,}<extra></extra>'};
  const tAss={x:dists,y:asmts,type:'bar',name:'Assessments',marker:{color:'#e76f51'},hovertemplate:'%{x}<br>Assessments: %{y:,}<extra></extra>'};
  Plotly.react('populationByDistrict',[tPop,tAss],{barmode:'group',height:260,xaxis:{tickangle:-45,automargin:true},yaxis:{title:''},margin:{t:10,b:100,l:60,r:10},legend:{orientation:'h',y:1.15,x:0.5,xanchor:'center'}});
}

/* Table */
const tableSearchEl=document.getElementById('tableSearch');
const ulbTableBody=document.querySelector('#ulbTable tbody');
const ulbTableHead=document.querySelector('#ulbTable thead');
function renderTable(f){
  const q=uiState.tableSearch.trim().toLowerCase();
  let rows=f.slice(); if(q) rows=rows.filter(d=>(d.ulb||'').toLowerCase().includes(q));
  const {key,dir}=uiState.tableSort;
  rows.sort((a,b)=> key==='ulb' ? (dir==='asc'?String(a.ulb).localeCompare(String(b.ulb)):String(b.ulb).localeCompare(String(a.ulb))) : (dir==='asc'?((a[key]??0)-(b[key]??0)):((b[key]??0)-(a[key]??0))));
  ulbTableBody.innerHTML=rows.map(r=>`<tr data-code="${r.ulb_code}"><td>${r.ulb}</td><td class="num">${nf0.format(r.assessments||0)}</td></tr>`).join('');
  ulbTableBody.querySelectorAll('tr').forEach(tr=>tr.addEventListener('click',()=>{const c=tr.getAttribute('data-code'); if(c){searchBox.value=c; refreshAll();}}));
}
ulbTableHead.querySelectorAll('th').forEach(th=>th.addEventListener('click',()=>{const k=th.getAttribute('data-key'); if(!k)return; uiState.tableSort.key===k ? uiState.tableSort.dir=(uiState.tableSort.dir==='asc'?'desc':'asc') : (uiState.tableSort.key=k, uiState.tableSort.dir='asc'); renderTable(getFilteredData());}));
tableSearchEl?.addEventListener('input',()=>{uiState.tableSearch=tableSearchEl.value; renderTable(getFilteredData());});

/* Map placeholder and GeoJSON upload */
let currentGeo=null;
function clearMap(){document.getElementById('mapPlaceholder').innerHTML='<div style="padding:12px;color:#666">Map not available: dataset has no coordinates. Upload a GeoJSON to visualize boundaries (GeoJSON should contain properties with a ULB_CODE to link).</div>';}
document.getElementById('geoUpload').addEventListener('change',evt=>{
  const f=evt.target.files[0]; if(!f) return;
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      currentGeo=JSON.parse(e.target.result);
      const valueByCode=data.reduce((acc,d)=>{acc[d.ulb_code]=d.assessments||0; return acc;}, {});
      const feats=(currentGeo.features||[]);
      const locations=feats.map(ft=>String(ft.properties.ULB_CODE||ft.properties.ulb_code||'')); 
      const z=locations.map(code=>valueByCode[code]||0);
      const labels=feats.map(ft=>ft.properties.ULB_NAME||ft.properties.NAME||'');
      Plotly.newPlot('mapPlaceholder',[{type:'choroplethmapbox',geojson:currentGeo,locations,z,featureidkey:'properties.ULB_CODE',colorscale:'Viridis',showscale:true,text:labels,hovertemplate:'%{text}<br>Assessments: %{z:,}<extra></extra>'}],{mapbox:{style:'carto-positron',center:{lon:80,lat:16},zoom:5.5},height:420,margin:{t:0,b:0,l:0,r:0}});
    }catch(err){clearMap(); alert('Invalid GeoJSON file or parse error: '+err.message);}
  };
  reader.readAsText(f);
});

/* Interactions */
function bindPlotInteractions(){
  document.getElementById('scatter').on('plotly_click',ev=>{const pt=ev.points&&ev.points[0]; if(pt&&pt.customdata){searchBox.value=String(pt.customdata); refreshAll();}});
  document.getElementById('assessmentsBar').on('plotly_click',ev=>{const pt=ev.points&&ev.points[0]; if(pt&&pt.customdata){searchBox.value=String(pt.customdata); refreshAll();}});
  document.getElementById('gradePie').on('plotly_click',ev=>{const label=ev.points&&ev.points[0]&&ev.points[0].label; if(!label)return; uiState.grade=(uiState.grade===label)?null:label; refreshAll();});
  document.getElementById('populationByDistrict').on('plotly_click',ev=>{const d=ev.points&&ev.points[0]&&ev.points[0].x; if(!d)return; uiState.district=(uiState.district===d)?null:d; refreshAll();});
}

/* Main update */
function refreshAll(){
  const f=getFilteredData();
  updateKPIs(f);
  updateGradePie(f);
  updateAssessmentsBar(f);
  updateAreaVsPopulationScatter(f);
  updatePopulationBar(f);
  renderTable(f);
}

/* Wire events and init */
regionFilter.addEventListener('change', refreshAll);
searchBox.addEventListener('keydown', e=>{if(e.key==='Enter') refreshAll();});
resetBtn.addEventListener('click',()=>{regionFilter.value=''; searchBox.value=''; uiState.grade=null; uiState.district=null; uiState.tableSearch=''; uiState.tableSort={key:'ulb',dir:'asc'}; const t=document.getElementById('tableSearch'); if(t) t.value=''; refreshAll();});

clearMap();
refreshAll();
bindPlotInteractions();

/* Resize handling */
window.addEventListener('resize', ()=>{refreshAll();});
<script>
  const geojsonUrl =
    "https://raw.githubusercontent.com/gisintelugu/apulb/main/ULB_Boundaries_4326.geojson";

  async function loadGeoJSONMapAndInitDashboard() {
    try {
      const response = await fetch(geojsonUrl);
      const geoData = await response.json();

      const traces = [];

      geoData.features.forEach((feature) => {
        const geom = feature.geometry;
        if (geom.type === "Polygon") {
          geom.coordinates.forEach((ring) => {
            const lon = ring.map((c) => c[0]);
            const lat = ring.map((c) => c[1]);
            traces.push({
              type: "scattermapbox",
              lon,
              lat,
              mode: "lines",
              line: { color: "#1f77b4", width: 2 },
              name: feature.properties?.ULB_NAME || "ULB Boundary",
            });
          });
        } else if (geom.type === "MultiPolygon") {
          geom.coordinates.forEach((poly) =>
            poly.forEach((ring) => {
              const lon = ring.map((c) => c[0]);
              const lat = ring.map((c) => c[1]);
              traces.push({
                type: "scattermapbox",
                lon,
                lat,
                mode: "lines",
                line: { color: "#1f77b4", width: 2 },
                name: feature.properties?.ULB_NAME || "ULB Boundary",
              });
            })
          );
        }
      });

      const layout = {
        mapbox: {
          style: "carto-positron",
          center: { lon: 79.5, lat: 15.8 },
          zoom: 6.2,
        },
        margin: { t: 0, b: 0, l: 0, r: 0 },
        showlegend: false,
      };

      Plotly.newPlot("mapPlaceholder", traces, layout);

      // ✅ Trigger your dashboard initialization after map load
      if (typeof initializeDashboard === "function") {
        initializeDashboard(rawData); // if your dashboard has a setup function
      } else {
        // fallback: run analytics setup manually
        if (typeof updateKPIs === "function") updateKPIs(rawData);
        if (typeof renderCharts === "function") renderCharts(rawData);
        if (typeof populateFilters === "function") populateFilters(rawData);
      }

    } catch (err) {
      console.error("Error loading GeoJSON:", err);
    }
  }

  document.addEventListener("DOMContentLoaded", loadGeoJSONMapAndInitDashboard);
</script>

</script>
</body>
</html>
